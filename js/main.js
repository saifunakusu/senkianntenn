(function(){function a(){let sa=r.videoWidth/r.videoHeight;s=Math.round(t*sa),r.width=s,p.width=s}function c(sa){'srcObject'in r?r.srcObject=sa:r.src=window.URL&&window.URL.createObjectURL(sa),r.onloadedmetadata=function(){a()},r.onresize=function(){a(),I&&(H.stop(),H.reset(),H.start(r))}}function d(){alert('\u304A\u4F7F\u3044\u306E\u74B0\u5883\u3067\u306F\u3054\u89A7\u3044\u305F\u3060\u3051\u307E\u305B\u3093...')}function g(){let sa=H.getCurrentParameters(),ta=H.getCurrentPosition();if(50<ta.length){let ua=ta[27],va=ta[32],wa=ta[37],xa=ua[0]-u[0],ya=ua[1]-u[1],za=Math.sqrt(xa*xa+ya*ya),Aa=va[0]-v[0],Ba=va[1]-v[1],Ca=Math.sqrt(Aa*Aa+Ba*Ba),Da=wa[0]-w[0],Ea=wa[1]-w[1],Fa=Math.sqrt(Da*Da+Ea*Ea);ya=ua[1]-u[1],Ba=va[1]-v[1],Ea=wa[1]-w[1],0.3<ya&&0.3<za-Fa&&(G=Math.floor(Math.random()*24),z=0==z?1:0,E()),u[0]=ua[0],u[1]=ua[1],v[0]=va[0],v[1]=va[1],w[0]=wa[0],w[1]=wa[1],C=25*((w[0]-80)*(window.innerWidth/160)),D=25*((w[1]-60)*(window.innerWidth/120))}}function k(){requestAnimationFrame(k),frame++,g(),l();let sa=1e3*clock.getDelta();W.getByteTimeDomainData(S),M=!0==N?J.currentTime-L:0,n(),mixer.update(sa)}function l(){for(let sa=0;512>sa;sa++)U[sa]*=0.99,U[sa]<S[sa]&&(U[sa]=S[sa]);camera.position.x+=0.05*(0.1*-C-camera.position.x),camera.position.y+=0.05*(0.1*-D-camera.position.y)+20,camera.lookAt(new THREE.Vector3(0,500,0)),cameraGo&&(camera.rotation.z=0.5*time,la.rotate()),time=1e-3*performance.now();for(let sa=0;100>sa;sa++)reactiveBoxes[sa].update();particleStart&&na.update(),water.material.uniforms.time.value-=1/60,water.render(),renderer.render(scene,camera)}function n(){3.8<=M&&4.1>=M?!animationFlags[1]&&(ja[5](),animationFlags[1]=!0):8.2<=M&&8.4>=M?!animationFlags[2]&&(ja[0](),animationFlags[2]=!0):10<=M&&10.8>=M?(!animationFlags[3]&&(ja[7](),animationFlags[3]=!0),ia.render()):11.3<=M&&11.4>=M?(!animationFlags[23]&&(la.firstAttack(),animationFlags[23]=!0),ia.render()):19<=M&&19.2>=M?(!animationFlags[5]&&(ja[3](),animationFlags[5]=!0),ia.render()):28<=M&&28.2>=M?(!animationFlags[6]&&(ja[4](),animationFlags[6]=!0),ia.render()):31<=M&&31.2>=M?(!animationFlags[7]&&(ja[1](),animationFlags[7]=!0),ia.render()):39.8<=M&&39.9>=M?ia.render():39.9<=M&&40>=M?(!animationFlags[20]&&(ja[3](),animationFlags[20]=!0),ia.render()):41.2<=M&&41.6>=M?(!animationFlags[21]&&(ja[7](),cameraGo=!0,animationFlags[21]=!0),ia.render()):46<=M&&46.2>=M?(!animationFlags[8]&&(ja[3](),animationFlags[8]=!0),ia.render()):48.8<=M&&49.6>=M?ia.render():52.3<=M&&52.5>=M?(!animationFlags[9]&&(la.defPos(),animationFlags[9]=!0),ia.render()):56.4<=M&&56.6>=M?(!animationFlags[22]&&(ja[4](),animationFlags[22]=!0),ia.render()):62<=M&&62.6>=M?(!animationFlags[10]&&(ja[3](),animationFlags[10]=!0),ia.render()):67.5<=M&&67.7>=M?(!animationFlags[11]&&(la.defPos(),animationFlags[11]=!0),ia.render()):72<=M&&72.2>=M?(!animationFlags[12]&&(la.update(),animationFlags[12]=!0),ia.render()):74<=M&&74.2>=M?(!animationFlags[13]&&(la.defPos(),animationFlags[13]=!0),ia.render()):75<=M&&75.2>=M?(!animationFlags[14]&&(la.updateLast(),animationFlags[14]=!0),ia.render()):77<=M&&77.2>=M?(!animationFlags[15]&&(ja[2](),animationFlags[15]=!0),ia.render()):77.8<=M&&78>=M?(!animationFlags[16]&&(ja[2](),animationFlags[16]=!0),ia.render()):78.1<=M&&78.3>=M?(!animationFlags[17]&&(la.defPos(),animationFlags[17]=!0),ia.render()):78<=M&&79>=M?($('#video').addClass('all-display'),ia.render()):78.9<=M&&88>=M&&!animationFlags[100]&&($('#back-to-top').addClass('visible'),animationFlags[100]=!0,setTimeout(function(){$('#back-to-top p').addClass('visible')},5e3))}const o=document.getElementById('viewport'),p=document.getElementById('canvas'),q=p.getContext('2d'),r=document.getElementById('video');let s=r.width,t=r.height,u=[,,],v=[,,],w=[,,],z=0,C=0,D=0,E,G=0;navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,window.URL=window.URL||window.webkitURL||window.msURL||window.mozURL,navigator.mediaDevices?navigator.mediaDevices.getUserMedia({video:{width:{min:160,max:160},height:{min:120,max:120},frameRate:{min:30,max:30}},audio:!1}).then(c).catch(d):navigator.getUserMedia?navigator.getUserMedia({video:{width:{min:160,max:160},height:{min:120,max:120},frameRate:{min:30,max:30}},audio:!1},c,d):alert('PC\u304B\u3089chrome\u6700\u65B0\u7248\u3067\u898B\u3066\u304F\u3060\u3055\u3044\u3002'),pModel.shapeModel.nonRegularizedVectors.push(9),pModel.shapeModel.nonRegularizedVectors.push(11);let H=new clm.tracker({useWebGL:!0});H.init(pModel);let I=!1;(function(){H.start(r),I=!0})();const J=new AudioContext;let K=0,L=0,M=0,N=!1,O=J.createGain();O.connect(J.destination);let P={};P.source=J.createBufferSource(),P.volume=J.createGain(),P.source.connect(P.volume),P.volume.connect(O),P.source.loop=!1;let Q=null,R=null,S=0;(function(sa){let ua=new XMLHttpRequest;ua.open('GET','DIGIH-master.mp3',!0),ua.responseType='arraybuffer',ua.onload=function(){sa.decodeAudioData(ua.response,wa=>{Q=wa},()=>{P.buffer=Q,P.source.buffer=P.buffer,P.source.start(sa.currentTime),P.source.loop=!1}),document.querySelector('button#playsound').removeAttribute('disabled')},ua.send()})(J,'sound.mp3');let U=Array(512);for(let sa=0;512>sa;sa++)U[sa]=0;S=new Uint8Array(512);let V,W=J.createAnalyser();W.fftSize=512,W.minDecibels=-100,W.maxDecibels=-30,window.addEventListener('resize',function(){renderer.setSize(window.innerWidth,window.innerHeight),camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix()},!1),Detector.webgl||(Detector.addGetWebGLMessage(),document.getElementById('container').innerHTML='');for(let sa=0;100>sa;sa++)animationFlags[sa]=!1;let X=new THREE.LoadingManager;X.onProgress=function(){};let Y=sa=>{if(sa.lengthComputable){100*(sa.loaded/sa.total)}},Z=()=>{};let ba=0,ca=0,da=0;class ga{constructor(){this.sphereScale=1,this.geometry=new THREE.BoxGeometry(40,40,40),this.material=new THREE.MeshBasicMaterial({color:16777215,envMap:ka.cubeTexture}),this.sphere=new THREE.Mesh(this.geometry,this.material),this.sphere.position.x=Math.floor(Math.random()*(maxpos+1-minpos))+minpos,this.sphere.position.y=Math.floor(Math.random()*(maxpos+1-0))+0,this.sphere.position.z=Math.floor(Math.random()*(1-minpos))+minpos,scene.add(this.sphere)}reinit(){this.sphere.position.x=Math.floor(Math.random()*(maxpos+1-minpos))+minpos,this.sphere.position.y=Math.floor(Math.random()*(maxpos+1-0))+0,this.sphere.position.z=-1e4}update(){this.sphere.rotation.x=0.5*time,this.sphere.rotation.z=0.5*time,this.sphere.position.z+=100,1e3<=this.sphere.position.z&&this.reinit();for(let sa=0;512>sa;sa++)this.trueScale=1>this.trueScale?1:0.01*sphereScale+0.4*(U[sa]-128),this.sphere.scale.x=this.trueScale,this.sphere.scale.y=this.trueScale,this.sphere.scale.z=this.trueScale}remove(){this.sphere.dispose(),scene.remove(this.sphere),this.geometry.dispose(),this.material.dispose()}}let ia,ja=[];(function(){container=document.getElementById('viewport'),document.body.appendChild(container),renderer=new THREE.WebGLRenderer,renderer.setSize(window.innerWidth,window.innerHeight),renderer.setClearColor(0),renderer.setPixelRatio(window.devicePixelRatio),renderer.shadowMap.enabled=!0,container.appendChild(renderer.domElement),scene=new THREE.Scene,mixer=new THREE.AnimationMixer(scene),scene.add(new THREE.AmbientLight(4473924)),camera=new THREE.PerspectiveCamera(40,window.innerWidth/window.innerHeight,0.5,1e6),camera.position.set(0,1e3,500),ia=new THREE.EffectComposer(renderer),ia.addPass(new THREE.RenderPass(scene,camera));let sa=new THREE.GlitchPass;sa.renderToScreen=!0,ia.addPass(sa),sa.goWild=!0;let ta=new THREE.DirectionalLight(16777215,1);ta.position.set(-1,1,1),scene.add(ta),scene.add(new THREE.AmbientLight(4473924)),waterNormals=new THREE.TextureLoader().load('img/waternormals.jpg'),waterNormals.wrapS=waterNormals.wrapT=THREE.RepeatWrapping,water=new THREE.Water(renderer,camera,scene,{textureWidth:512,textureHeight:512,waterNormals:waterNormals,alpha:1,sunDirection:ta.position.clone().normalize(),sunColor:16777215,waterColor:7695,distortionScale:0}),mirrorMesh=new THREE.Mesh(new THREE.PlaneBufferGeometry(100*parameters.width,100*parameters.height,1,1),water.material),mirrorMesh.add(water),mirrorMesh.rotation.x=0.5*-Math.PI,scene.add(mirrorMesh)})();let ka=new class{constructor(){this.cubeShader=THREE.ShaderLib.cube,this.cubeMap=new THREE.CubeTexture([]),this.cubeMap.format=THREE.RGBFormat,this.loader=new THREE.ImageLoader,this.init()}init(sa){this.imgPath='img/'+sa+'.jpg',this.loader.load(this.imgPath,ta=>{let ua=(va,wa)=>{let xa=1024,ya=document.createElement('canvas');ya.width=xa,ya.height=xa;let za=ya.getContext('2d');return za.drawImage(ta,-va*xa,-wa*xa),ya};this.cubeMap.images[0]=ua(2,1),this.cubeMap.images[1]=ua(0,1),this.cubeMap.images[2]=ua(1,0),this.cubeMap.images[3]=ua(1,2),this.cubeMap.images[4]=ua(1,1),this.cubeMap.images[5]=ua(3,1),this.cubeMap.needsUpdate=!0}),this.cubeShader.uniforms.tCube.value=this.cubeMap,this.cubeTexture=this.cubeMap}render(){this.skyBoxMaterial=new THREE.ShaderMaterial({fragmentShader:this.cubeShader.fragmentShader,vertexShader:this.cubeShader.vertexShader,uniforms:this.cubeShader.uniforms,side:THREE.BackSide}),this.skyBox=new THREE.Mesh(new THREE.BoxGeometry(1e6,1e6,1e6),this.skyBoxMaterial),this.skyBox.position.set(0,0,0),this.skyBox.rotation.set(0,0,0),scene.add(this.skyBox)}};ka.render();let la=new class{constructor(){this.elMaterial=new THREE.MeshPhongMaterial({ambient:16777215,color:16777215,specular:16777215,shininess:50,side:THREE.FrontSide,envMap:ka.cubeTexture}),this.objLoader=new THREE.OBJLoader,this.objLoader.load('obj/Crystal.obj',sa=>{sa.traverse(ua=>{ua instanceof THREE.Mesh&&(ua.material=this.elMaterial)}),this.firstElement=sa.clone();Math.floor(Math.random()*181)+90;this.firstElement.scale.set(0.2,0.2,0.2),this.firstElement.position.set(0,500,0),this.firstElement.rotation.set(Math.PI,0,0),scene.add(this.firstElement)})}remove(){this.elMaterial.dispose(),scene.remove(this.firstElement)}update(){ba=Math.floor(Math.random()*1601)-800,ca=Math.floor(Math.random()*1601)-800,da=Math.floor(Math.random()*-799),this.firstElement.position.x=ba,this.firstElement.position.y=ca+550,this.firstElement.position.z=da}updateLast(){ba=Math.floor(Math.random()*801)-400,ca=Math.floor(Math.random()*801)-400,da=Math.floor(Math.random()*-399),this.firstElement.position.x=ba,this.firstElement.position.y=ca+550,this.firstElement.position.z=da}defPos(){ba=0,ca=0,da=0,this.firstElement.position.x=0,this.firstElement.position.y=550,this.firstElement.position.z=0}firstAttack(){ba=400,ca=400,da=-800,this.firstElement.position.x=ba,this.firstElement.position.y=ca+550,this.firstElement.position.z=da}rotate(){this.firstElement.rotation.z=0.5*time}};for(let sa=0;100>sa;sa++)reactiveBoxes[sa]=new ga(100*sa);let ma=new class{constructor(){this.morphMaterial=new THREE.MeshPhongMaterial({color:16777215,envMap:ka.cubeTexture}),this.tl=new TimelineMax}waveob(sa){this.jsonLoader=new THREE.JSONLoader,this.loadJson=sa}render(){this.jsonLoader.load(this.loadJson,(sa,ta)=>{setTimeout((()=>{for(let xa=0;60>xa;xa++)this.mainMesh=new THREE.Mesh(sa,this.morphMaterial),this.mainMesh.scale.set(1,1,1),this.mainMesh.position.set(0,550,-1e4*xa),this.tl.to(this.mainMesh.rotation,20,{z:2*Math.PI,repeat:-1,ease:Power0.easeNone},0.5*-xa),scene.add(this.mainMesh)})(sa,ta),10)},Y,Z)}update(){}};ma.waveob('json/hugewakuwaku.json'),ma.render(),ma.update();let na=new class{constructor(){this.tick=0,this.particleSystem=new THREE.GPUParticleSystem({maxParticles:2.5e5}),scene.add(this.particleSystem),this.options={position:new THREE.Vector3,positionRandomness:.5,velocity:new THREE.Vector3,velocityRandomness:.5,color:11176191,colorRandomness:1,turbulence:100,lifetime:50,size:3,sizeRandomness:1},this.spawnerOptions={spawnRate:15000,horizontalSpeed:10.5,verticalSpeed:10.33,timeScale:1}}reinit(){}update(){if(this.delta=clock.getDelta()*this.spawnerOptions.timeScale,this.tick+=this.delta,0>this.tick&&(this.tick=0),0<this.delta){this.options.position.x=100*Math.sin(this.tick*this.spawnerOptions.horizontalSpeed)+ba,this.options.position.y=80*Math.sin(this.tick*this.spawnerOptions.verticalSpeed)+500+ca,this.options.position.z=10*Math.sin(this.tick*this.spawnerOptions.horizontalSpeed+this.spawnerOptions.verticalSpeed)+da+50;for(let sa=0;sa<this.spawnerOptions.spawnRate*this.delta;sa++)this.particleSystem.spawnParticle(this.options)}this.particleSystem.update(this.tick)}remove(){this.particleSystem.dispose(),scene.remove(this.particleSystem)}};E=function(){ka.init(G)},E(),k(),ja[0]=function(){let ta={wrapper:svg,animType:'svg',loop:!1,prerender:!0,autoplay:!0,path:'json/aejson02.json'},ua=bodymovin.loadAnimation(ta);ua.addEventListener('complete',function(){ua.destroy()})},ja[5]=function(){let ta={wrapper:svg,animType:'svg',loop:!1,prerender:!0,autoplay:!0,path:'json/effects2d03.json'},ua=bodymovin.loadAnimation(ta);ua.addEventListener('complete',function(){ua.destroy()})},ja[1]=function(){let ta={wrapper:svg,animType:'svg',loop:!1,prerender:!0,autoplay:!0,path:'json/aejson01.json'},ua=bodymovin.loadAnimation(ta);ua.addEventListener('complete',function(){ua.destroy()}),la.update()},ja[2]=function(){let ta={wrapper:svg,animType:'svg',loop:!1,prerender:!0,autoplay:!0,path:'json/effects2d03.json'},ua=bodymovin.loadAnimation(ta);ua.addEventListener('complete',function(){ua.destroy()}),la.update()},ja[6]=function(){let ta={wrapper:svg,animType:'svg',loop:!1,prerender:!0,autoplay:!0,path:'json/effects2d03.json'},ua=bodymovin.loadAnimation(ta);ua.addEventListener('complete',function(){ua.destroy()}),la.updateLast()},ja[8]=function(){let ta={wrapper:svg,animType:'svg',loop:!1,prerender:!0,autoplay:!0,path:'json/effects2d03.json'},ua=bodymovin.loadAnimation(ta);ua.addEventListener('complete',function(){ua.destroy()}),la.defPos()},ja[7]=function(){let ta={wrapper:svg,animType:'svg',loop:!1,prerender:!0,autoplay:!0,path:'json/effects2d03.json'},ua=bodymovin.loadAnimation(ta);ua.addEventListener('complete',function(){ua.destroy()})},ja[3]=function(){let ta={wrapper:svg,animType:'svg',loop:!1,prerender:!0,autoplay:!0,path:'json/aejson02.json'},ua=bodymovin.loadAnimation(ta);ua.addEventListener('complete',function(){ua.destroy()}),la.update()},ja[4]=function(){let ta={wrapper:svg,animType:'svg',loop:!1,prerender:!0,autoplay:!0,path:'json/aejson04.json'},ua=bodymovin.loadAnimation(ta);ua.addEventListener('complete',function(){ua.destroy()}),la.update()};var qa=0,ra=0;$(function(){let sa,ta;$('#first-navi').hasClass('navi-time')&&(sa=()=>{ta=requestAnimationFrame(sa),firstDomTargetX=0.05*-C,qa+=0.1*(firstDomTargetX-qa),firstDomTargetY=0.05*D,ra+=0.1*(firstDomTargetY-ra),$('.face-contorols').css({transform:'translate('+qa+'px,'+ra+'px)'}).fadeIn(300),0==z?($('#face-ex').css({'background-color':' transparent'}),$('#face-ex').css({color:'rgb(255, 255, 255)'})):($('#face-ex').css({'background-color':'rgb(255, 255, 255)'}),$('#face-ex').css({color:'rgb(0, 0, 0)'}))}),sa(),setTimeout(function(){$('#face-txt').stop().animate({opacity:'0'},100),$('#blink-txt').stop().animate({opacity:'1'},600)},8e3),setTimeout(function(){$('#face-ok-button').stop().animate({opacity:'1'},600)},11000),$('#face-ok-button').click(function(){$('#white-color').stop().animate({opacity:'1'},300),$('#face-ex').fadeOut(300),setTimeout(function(){$('#first-navi').stop().fadeOut(300)},300),setTimeout(function(){$('#face-ex').removeClass('blink-contorols')},910),setTimeout(function(){$('#first-navi').removeClass('navi-time')},950),cancelAnimationFrame(ta)}),$('#all-skip').click(function(){$('#white-color').stop().animate({opacity:'1'},300),$('#face-ex').fadeOut(300),setTimeout(function(){$('#first-navi').stop().fadeOut(300)},300),setTimeout(function(){$('#face-ex').removeClass('face-contorols')},910),setTimeout(function(){$('#first-navi').removeClass('navi-time')},950),cancelAnimationFrame(ta)})}),V=requestAnimationFrame(k),document.querySelector('button#playsound').addEventListener('click',sa=>{TweenMax.to('#playsound',1.8,{autoAlpha:0}),TweenMax.to('#title',2.8,{autoAlpha:0,ease:Power1.easeOut});let ta;'Stop'==sa.target.innerHTML?(R.stop(0),cancelAnimationFrame(V),ta='Start',K=J.currentTime,N=!1):!1==N&&(R=J.createBufferSource(),R.buffer=Q,R.loop=!1,R.connect(J.destination),R.connect(W),R.start(0),L=J.currentTime-K,N=!0,setTimeout(function(){particleStart=!0},2e3),ta='Play'),sa.target.innerHTML=ta})})();
